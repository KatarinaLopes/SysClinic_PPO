<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>
        <h:form id="apresentarMedicosForm">
            Funcionários cadastrados 

            <p:dataTable id="apresentarMedicos" var="medico" 
                         value="#{controllerMedico.medicosRegistrados}" 
                         rowKey="#{medico.matricula}" selectionMode="single"
                         paginator="true" resizableColumns="true">

                <p:column headerText="Matrícula">
                    <h:outputText value="#{medico.matricula}"/>
                </p:column>
                <p:column headerText="Nome">
                    <h:outputText value="#{medico.nome}"/>
                </p:column>
                <p:column headerText="Conselho">
                    <h:outputText value="#{medico.conselho}"/>
                </p:column>

                <p:column headerText="Especialidade">
                    <h:outputText value="#{medico.especialidade}"/>
                </p:column>

                <p:column headerText="Telefone">
                    <h:outputText value="#{medico.telefone}"/>
                </p:column>

                <p:column>

                    <p:commandButton value="Visualizar" 
                                     update=":apresentarMedicosForm :dialVisualizarMedicoForm"
                                     oncomplete="PF('widVisualizarMedico').show()">
                        <f:setPropertyActionListener value="#{medico}" 
                                                     target="#{controllerMedico.
                                                               medicoSelecionado}"/>
                    </p:commandButton>

                    <p:commandButton value="Alterar"
                                     update=":apresentarMedicosForm 
                                     :alterarMedicoDialForm"
                                     oncomplete="PF('widAlterarMedico').show()"
                                     rendered="#{controllerFuncionario.
                                                 funcionarioLogado.
                                                 administrador}">
                        <f:setPropertyActionListener value="#{medico}"
                                                     target="#{
                                                     controllerMedico.
                                                         medicoSelecionado}"/>
                    </p:commandButton>

                    <p:commandButton value="Excluir" 
                                     update=":apresentarMedicosForm"
                                     rendered="#{controllerFuncionario.
                                                 funcionarioLogado.
                                                 administrador}"
                                     oncomplete="PF('widConfirmDialog').show()">
                        <f:setPropertyActionListener value="#{medico}"
                                                     target="#{controllerMedico.
                                                               medicoSelecionado}"/>
                    </p:commandButton>
                </p:column>
                <p:column>
                    <p:commandButton value="Horários" 
                                     update=":apresentarMedicosForm
                                     :apresentarHorariosDialForm"
                                     oncomplete="PF('widDialHorario').show()">
                        <f:setPropertyActionListener value="#{medico}"
                                                     target="#{
                                                     controllerMedico.
                                                         medicoSelecionado}"/>
                    </p:commandButton>
                    <p:commandButton value="Editar horários"
                                     update=":apresentarMedicosForm 
                                     :dial-editar-horarios"
                                     oncomplete="PF('wid-dial-editar-horarios').show()">
                        <f:setPropertyActionListener value="#{medico}"
                                                     target="#{controllerMedico.medicoSelecionado}"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>

        </h:form>
        <p:dialog id="dialVisualizarMedicos" 
                  widgetVar="widVisualizarMedico" visible="false"
                  modal="true" 
                  header="Visualizar médicos">
            <h:form id="dialVisualizarMedicoForm">
                <p:panelGrid columns="2">
                    <h:outputText value="Matrícula"/>
                    <h:outputText 
                        value="
                        #{controllerMedico.medicoSelecionado.matricula}"/>

                    <h:outputText value="Data de admissão"/>
                    <h:outputText 
                        value="
                        #{controllerMedico.medicoSelecionado.dataAdmissao}"/>

                    <h:outputText value="Nome"/>
                    <h:outputText value="
                                  #{controllerMedico.medicoSelecionado.nome}"/>

                    <h:outputText value="Sexo"/>
                    <h:outputText value="#{controllerMedico.medicoSelecionado.
                                           sexo}"/>

                    <h:outputText value="Conselho"/>
                    <h:outputText value="#{
                                  controllerMedico.medicoSelecionado.
                                      conselho}"/>

                    <h:outputText value="Especialidade"/>
                    <h:outputText value="
                                  #{controllerMedico.medicoSelecionado.
                                    especialidade}"/>

                    <h:outputText value="Telefone para contato"/>
                    <h:outputText value="#{controllerMedico.medicoSelecionado.
                                           telefone}"/>

                    <h:outputText value="Email"/>
                    <h:outputText value="
                                  #{controllerFuncionario.
                                    funcionarioSelecionado.email}"/>
                </p:panelGrid>

            </h:form>

        </p:dialog>

        <p:dialog id="dialAlterarMedico" 
                  header="Alterar médico"
                  modal="true" visible="false" 
                  widgetVar="widAlterarMedico">
            <h:form id='alterarMedicoDialForm'>

                <p:panelGrid columns="3">
                    <h:outputText value="Matrícula"/>
                    <p:inputText id="matricula" required="true" 
                                 requiredMessage="Campo obrigatório"
                                 value="#{controllerMedico.medicoSelecionado.
                                          matricula}"/>
                    <p:message for="matricula"/>

                    <h:outputText value="Data de admissão"/>
                    <p:calendar id="dataAdmissao" pattern="dd-MM-yyyy" 
                                maxdate="today" required="true"
                                requiredMessage="Campo obrigatório"
                                value="#{controllerMedico.medicoSelecionado.
                                         dataAdmissao}"/>
                    <p:message for="dataAdmissao"/>

                    <h:outputText value="Nome"/> 
                    <p:inputText id="nome" maxlength="70" 
                                 placeholder="Ex.: Maria da Silva" required="true"
                                 requiredMessage="Campo obrigatório" 
                                 value="#{
                                 controllerMedico.medicoSelecionado.nome}">
                    </p:inputText>
                    <p:message for="nome"/>

                    <h:outputText value="Sexo"/>
                    <p:selectOneRadio value="#{
                                      controllerMedico.medicoSelecionado.sexo}" 
                                      id="sexo"
                                      required="true" 
                                      requiredMessage="Campo obrigatório">
                        <f:selectItem itemValue="F" itemLabel="Feminino"/>
                        <f:selectItem itemValue="M" itemLabel="Masculino"/>
                    </p:selectOneRadio>
                    <p:message for="sexo"/>

                    <h:outputText value="Conselho"/>
                    <p:inputText id="conselho" 
                                 value="#{
                                 controllerMedico.medicoSelecionado.conselho}"
                                 required="true" 
                                 requiredMessage="Campo obrigatório"/>
                    <p:message for="conselho"/>


                    <h:outputText value="Especialidade"/>
                    <p:inputText id="especialidade" value="#{controllerMedico.
                                                             medicoSelecionado.
                                                             especialidade}"/>
                    <p:message for="especialidade"/>

                    <h:outputText value="Telefone para contato"/>
                    <p:inputMask id="telefoneContato" mask="(99)9999-9999" 
                                 value="#{
                                 controllerMedico.medicoSelecionado.telefone}"
                                 placeholder="(99)9999-9999" required="true" 
                                 requiredMessage="Campo obrigatório"/>
                    <p:message for="telefoneContato"/>

                    <h:outputText value="Email"/>
                    <p:inputText id="email" value="#{
                                 controllerMedico.medicoSelecionado.email}"
                                 placeholder="email@email.com"/>
                    <p:message for="email"/>



                </p:panelGrid>

                <p:commandButton value="Alterar" 
                                 action="#{controllerMedico.
                                           atualizar(controllerMedico.
                                           medicoSelecionado)}"
                                 update=":apresentarMedicosForm 
                                 :alterarMedicoDialForm"
                                 oncomplete="
                                 PF('widAlterarMedico').hide()"/>
            </h:form>

        </p:dialog>

        <p:dialog id="confirmDialog" visible="false" modal="true" 
                  dynamic="true"
                  widgetVar="widConfirmDialog">
            Deseja realmente excluir este médico?<br/>
            Todos os agendamentos serão excluídos.
            <br/>
            <p:commandButton value="Sim"
                             actionListener="#{controllerPaciente.
                                       incluirMensagensDeExclusaoDeAgendamento(controllerMedico.
                                       medicoSelecionado)}"
                             action="#{controllerMedico.
                                               deletar(
                                               controllerMedico.
                                               medicoSelecionado)}"
                             oncomplete="PF('widConfirmDialog').hide()"/>
            <p:commandButton value="Não" 
                             oncomplete="PF('widConfirmDialog').hide()"/>

        </p:dialog>

        <p:dialog id="dialHorario" header="Horários" modal="true"  
                  visible="false" widgetVar="widDialHorario">
            <h:form id="apresentarHorariosDialForm">
                <p:dataTable id="horarios" var="horario" 
                             value="#{controllerMedico.
                                      medicoSelecionado.horarios}" 
                             rowKey="#{horarios.dia}">

                    <p:column headerText="Dia">
                        <h:outputText value="#{horario.dia}"/>
                    </p:column>

                    <p:column headerText="Horário inicial">
                        <h:outputText value="#{horario.horarioInicial}"/>
                    </p:column>

                    <p:column headerText="Horário final">
                        <h:outputText value="#{horario.horarioFinal}"/>
                    </p:column>

                </p:dataTable>
            </h:form>
        </p:dialog>

        <p:dialog closable="true" dynamic="true" header="Editar horários"
                  id="dial-editar-horarios" modal="true" responsive="true"
                  visible="false" widgetVar="wid-dial-editar-horarios">

            <h:form>
                <h3>
                    <h:outputText value="#{controllerMedico.medicoSelecionado.nome}
                                  - #{controllerMedico.medicoSelecionado.matricula}"/>
                </h3>        

                <p:dataTable disabledSelection="true" editable="true" 
                             id="tabela-editar-horarios" paginator="true" 
                             rows="5" 
                         value="#{controllerMedico.medicoSelecionado.horarios}"
                             var="horario">

                    <p:ajax event="rowEdit" 
                            listener="#{controllerMedico.
                                        atualizarHorario(controllerMedico.
                                        medicoSelecionado,
                                        horario, dia, 
                                        horarioInicial, horarioFinal, 
                                        agendamentos)}"
                            update="tabela-editar-horarios"/>
                    
                    <p:column headerText="Dia">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{horario.dia}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu id="dia" required="true" 
                                                 value="#{dia}">
                                    <f:selectItems value="#{builderMedico.
                                                            diasDaSemana}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column headerText="Horário inicial">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{horario.horarioInicial}">
                                    <f:convertDateTime timeStyle="short" 
                                                       type="time"
                                                       timeZone="#{initParam.
                                                                   timezone}"/>
                                </h:outputText>
                            </f:facet>
                            <f:facet name="input">
                                <p:calendar pattern="HH:mm" readonlyInput="true"
                                            timeInput="true" timeOnly="true" 
                                            value="#{horarioInicial}">
                                    <f:convertDateTime timeStyle="short" 
                                                       type="time" 
                                                       timeZone="#{initParam.
                                                                   timezone}"/>
                                </p:calendar>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column headerText="Horário final">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{horario.horarioFinal}">
                                    <f:convertDateTime timeStyle="short"
                                                       type="time"/>
                                </h:outputText>
                            </f:facet>
                            <f:facet name="input">
                                <p:calendar pattern="HH:mm" readonlyInput="true"
                                            timeInput="true" timeOnly="true" 
                                            value="#{horarioFinal}">
                                    <f:convertDateTime timeStyle="short"
                                                       type="time"
                                                       timeZone="#{initParam.
                                                                   timezone}"/>
                                </p:calendar>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column headerText="Agendamentos">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText
                                    value="#{horario.limiteDeAgendamentos}"/>
                            </f:facet>
                            <f:facet name="input">
                                <h:inputText 
                                    value="#{horario.limiteDeAgendamentos}"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column>
                        <p:rowEditor cancelTitle="Cancelar" editTitle="Editar"
                                     saveTitle="Salvar"/>
                    </p:column>
                </p:dataTable>

                <p:commandButton value="Editar" 
                                 action="#{controllerMedico.
                                           atualizar(controllerMedico.
                                           medicoSelecionado)}"
                           oncomplete="PF('wid-dial-editar-horarios').hide()"/>
            </h:form>
        </p:dialog>
    </h:body>
</html>

